<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maquettes Jem - Th√®me</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>üé® Maquettes Jem</h1>
            <p id="themeName">Chargement...</p>
        </div>
    </header>

    <div class="breadcrumb">
        <div class="container">
            <a href="index.html">‚Üê Retour aux th√®mes</a>
        </div>
    </div>

    <main>
        <div class="container">
            <div id="maquettesContainer">
                <!-- Les maquettes seront charg√©es ici -->
            </div>
        </div>
    </main>

    <!-- Modal pour afficher les maquettes en iframe -->
    <div class="modal" id="maquetteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Maquette</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <iframe id="maquetteFrame" src=""></iframe>
            </div>
        </div>
    </div>

    <script>
        // R√©cup√©rer l'ID du th√®me depuis l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const themeId = urlParams.get('id');

        if (!themeId) {
            window.location.href = 'index.html';
        }

        // Charger les donn√©es
        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                const theme = data.themes.find(t => t.id === themeId);
                if (theme) {
                    displayTheme(theme);
                } else {
                    document.getElementById('themeName').textContent = 'Th√®me introuvable';
                    document.getElementById('maquettesContainer').innerHTML = 
                        '<div class="empty-state"><div class="icon">‚ùå</div><p>Ce th√®me n\'existe pas.</p></div>';
                }
            })
            .catch(error => {
                console.error('Erreur lors du chargement des donn√©es:', error);
                document.getElementById('maquettesContainer').innerHTML = 
                    '<p style="color: var(--rouge-corail);">Erreur lors du chargement des maquettes.</p>';
            });

        function displayTheme(theme) {
            document.getElementById('themeName').textContent = theme.nom;
            document.title = `Maquettes Jem - ${theme.nom}`;

            const container = document.getElementById('maquettesContainer');
            
            if (!theme.maquettes || theme.maquettes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üìã</div>
                        <h3>Aucune maquette pour ce th√®me</h3>
                        <p>Commence par ajouter une maquette dans le fichier data.json</p>
                    </div>
                `;
                return;
            }

            const list = document.createElement('div');
            list.className = 'maquettes-list';

            theme.maquettes.forEach(maquette => {
                const item = createMaquetteItem(maquette);
                list.appendChild(item);
            });

            container.appendChild(list);
        }

        function createMaquetteItem(maquette) {
            const item = document.createElement('div');
            item.className = 'maquette-item';

            // Header avec nom et date
            const header = document.createElement('div');
            header.className = 'maquette-header';
            header.innerHTML = `
                <div>
                    <h3>${maquette.nom}</h3>
                </div>
                <div class="maquette-date">
                    ${formatDate(maquette.date)}
                </div>
            `;
            item.appendChild(header);

            // Images si pr√©sentes
            if (maquette.images && maquette.images.length > 0) {
                const imagesContainer = document.createElement('div');
                imagesContainer.className = 'maquette-images';
                
                maquette.images.forEach(imagePath => {
                    const img = document.createElement('img');
                    img.src = imagePath;
                    img.alt = maquette.nom;
                    img.onclick = () => window.open(imagePath, '_blank');
                    imagesContainer.appendChild(img);
                });
                
                item.appendChild(imagesContainer);
            }

            // Actions
            const actions = document.createElement('div');
            actions.className = 'maquette-actions';
            
            if (maquette.fichier) {
                const btnIframe = document.createElement('button');
                btnIframe.className = 'btn btn-primary';
                btnIframe.textContent = 'üëÅÔ∏è Voir dans iframe';
                btnIframe.onclick = () => openModal(maquette.nom, maquette.fichier);
                actions.appendChild(btnIframe);

                const btnPlein = document.createElement('a');
                btnPlein.className = 'btn btn-secondary';
                btnPlein.textContent = 'üîó Ouvrir en plein √©cran';
                btnPlein.href = maquette.fichier;
                btnPlein.target = '_blank';
                actions.appendChild(btnPlein);
            }

            item.appendChild(actions);

            // Commentaires
            if (maquette.commentaires && maquette.commentaires.length > 0) {
                const commentsSection = document.createElement('div');
                commentsSection.className = 'comments-section';
                
                const commentsTitle = document.createElement('h4');
                commentsTitle.textContent = `üí¨ Commentaires (${maquette.commentaires.length})`;
                commentsSection.appendChild(commentsTitle);

                maquette.commentaires.forEach(comment => {
                    const commentDiv = document.createElement('div');
                    commentDiv.className = 'comment';
                    commentDiv.innerHTML = `
                        <div class="comment-date">${formatDate(comment.date)}</div>
                        <div class="comment-text">${comment.texte}</div>
                    `;
                    commentsSection.appendChild(commentDiv);
                });

                item.appendChild(commentsSection);
            }

            return item;
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('fr-FR', options);
        }

        function openModal(title, src) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('maquetteFrame').src = src;
            document.getElementById('maquetteModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('maquetteModal').classList.remove('active');
            document.getElementById('maquetteFrame').src = '';
        }

        // Fermer le modal avec la touche √âchap
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Fermer le modal en cliquant en dehors
        document.getElementById('maquetteModal').addEventListener('click', (e) => {
            if (e.target.id === 'maquetteModal') {
                closeModal();
            }
        });
    </script>
</body>
</html>
